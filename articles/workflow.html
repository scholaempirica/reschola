<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="The Schola Empirica Workflows: Principles, Tools, Step-by-Step Guide">
<title>The Workflow • reschola</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The Workflow">
<meta property="og:description" content="The Schola Empirica Workflows: Principles, Tools, Step-by-Step Guide">
<meta property="og:image" content="https://scholaempirica.github.io/reschola/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">reschola</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/reschola.html">Get started</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-how-to-s">How-to's</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-how-to-s">
    <a class="dropdown-item" href="../articles/setup.html">Setup</a>
    <a class="dropdown-item" href="../articles/tips.html">Tips and tricks</a>
    <a class="dropdown-item" href="../articles/workflow.html">The Workflow</a>
    <a class="dropdown-item" href="../articles/charts.html">Making charts</a>
    <a class="dropdown-item" href="../articles/meta.html">Keeping this package up to scratch</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">What's new</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/scholaempirica/reschola/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/scholaempirica/reschola/issues">
    <span class="fa fa-exclamation-circle fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="workflow_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>The Workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/scholaempirica/reschola/blob/HEAD/vignettes/workflow.Rmd" class="external-link"><code>vignettes/workflow.Rmd</code></a></small>
      <div class="d-none name"><code>workflow.Rmd</code></div>
    </div>

    
    
<p>This vignette describes the ideal data analytical workflow used by the Schola Empirica team.</p>
<div class="section level2">
<h2 id="objective">Objective<a class="anchor" aria-label="anchor" href="#objective"></a>
</h2>
<div class="section level4 bs-callout bs-callout-green">
<h4 id="section"></h4>
<p>To do analysis and create great reports reproducibly and efficiently.</p>
<p>To make our lives easier.</p>
<p>To make life easier for our future selves.</p>
</div>
</div>
<div class="section level2">
<h2 id="principles">Principles<a class="anchor" aria-label="anchor" href="#principles"></a>
</h2>
<div class="section level3">
<h3 id="reproducible-projects">1. Reproducible projects<a class="anchor" aria-label="anchor" href="#reproducible-projects"></a>
</h3>
<p>Project structure should be such that it is obvious what happens where and the whole project can be rerun quickly, perhaps on new data. Ideally, the structure also facilitates efficiency, i.e. during analysis things are not rerun which only need to be done once etc.</p>
</div>
<div class="section level3">
<h3 id="reproducible-reports">2. Reproducible reports<a class="anchor" aria-label="anchor" href="#reproducible-reports"></a>
</h3>
<p>Everything we submit to a client/partner/stakeholder should be based on data and code that together reproducibly create the report: no hacks, no manual edits if at all possible, no copy-pasting images from one place to another.</p>
<p>Version control helps us track when each report was created, using what code and what data, and can help us go back and fix things if needed. It also helps us avoid mostly duplicate versions of everything lying around.</p>
<blockquote>
<p>Code and data are real.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="consistent-style-of-outputs">3. Consistent style of outputs<a class="anchor" aria-label="anchor" href="#consistent-style-of-outputs"></a>
</h3>
<p>Reports and charts are based on well-designed styles and templates which we use consistently.</p>
</div>
<div class="section level3">
<h3 id="good-documentation">3. Good documentation<a class="anchor" aria-label="anchor" href="#good-documentation"></a>
</h3>
<p>Projects and reports should be self-documenting by their structure, code, workflow, and comments inside, and the git history with good commit messages.</p>
</div>
<div class="section level3">
<h3 id="efficiency">4. Efficiency<a class="anchor" aria-label="anchor" href="#efficiency"></a>
</h3>
<p>Let’s not repeat code and keep reinventing the wheel.</p>
</div>
</div>
<div class="section level2">
<h2 id="building-blocks">Building blocks<a class="anchor" aria-label="anchor" href="#building-blocks"></a>
</h2>
<div class="section level4 bs-callout bs-callout-blue">
<h4 id="on-reproducibility-frameworks">On reproducibility frameworks<a class="anchor" aria-label="anchor" href="#on-reproducibility-frameworks"></a>
</h4>
<p>The workflow described here does not rely on a particular framework that would enforce a project structure and a way of orchestrating all the bits together.</p>
<p>It is more lightweight - it suggests a structure, a way of working, and provides suggested integrators (such as <code>build.R</code> and <code>shared.R</code> and the <code>00_</code> data load scripts). It relies on simple order of execution and on the analyst putting the right bits of code in the right places.</p>
<p>You are free to change any of this, but also responsible for making sure that the system you create actually works.</p>
<p>This lightweight approach also does not provide any optimalisation with regard to build time, like a <code>make</code>- or <code>drake</code>-based workflow would (e.g. by only rebuilding outputs when te code has changed.)</p>
<p>If you would like a more rigid framework or need one that optimizes for computing time, look through your options in the <a href="#resources-for-building-reproducible-workflows">Resources</a> section below.</p>
</div>
<div class="section level3">
<h3 id="project-initiation-via-the-project-template">1. Project initiation via the project template<a class="anchor" aria-label="anchor" href="#project-initiation-via-the-project-template"></a>
</h3>
<p>The <code>reschola</code> package provides an RStudio project template that (a) takes care of setting up your project on Github (if you let it) and (b) creates a default project structure, incorporating key parameters that you give it in setup.</p>
</div>
<div class="section level3">
<h3 id="default-project-structure">2. Default project structure<a class="anchor" aria-label="anchor" href="#default-project-structure"></a>
</h3>
<p>Feel free to adapt this in any way that works and remains understandable to someone who is not you.</p>
<ul>
<li>
<code>shared.R</code> for variables and perhaps functions shared by more scripts. By default contains GDrive URL and project title, if provided during setup</li>
<li>
<code>001_retrieve-data.R</code> helps you download files from your GDrive folder, if set. You can also use it to store code for retrieving other data. This should only hold things which you expect to only run once, or refresh rarely - particularly things that take time or put a load on other servers.</li>
<li>
<code>002_read-data.R</code> should hold code that reads the data and does any transformations immediately tied to data reading, e.g. setting data types or basic filtering. Again, this is code that you don’t expect to change as you work on the actual analysis. You may want to save the result into <code>rds</code> files in <code>data-intermediate</code> (or <code>data-input</code> if it is simply an <code>rds</code> mirror of the input data saved for quick access.)</li>
<li>
<code>003_check-and-process-data.R</code> (if you plan to run it often, you may wish signal this by numbering it <code>01_*</code> to rerun it often with the rest of the analysis, and you may also turn it into an Rmd file if that is more convenient.) This should process data in <code>data-input</code> and save its outputs in <code>data-processed</code>.</li>
<li>
<code>[NN]_*.Rmd</code> where NN is 01-98 is the actual analysis - may be an exploratory script, a partial analysis, or a report. Expected to be run in the order of their numbering, but ideally key components should work off data saved in <code>data-input</code> or <code>data-intermediate</code>.</li>
<li>
<code>data-input</code> should contain only unaltered input data as downloaded.</li>
<li>
<code>data-processed</code> should contain processed data files</li>
<li>
<code>data-output</code> should contain data that you expect to share externally that are the output of your project</li>
<li>
<code>charts-output</code> and <code>reports-output</code> for the obvious</li>
<li>
<code>99_reproducibility.R</code> by default contains a description of the system and environment used to run the analysis. Use it to store any other information useful for reproducing the analysis (but not passwords etc.)</li>
</ul>
<p>You should feel free to move code between the analysis and the <code>00*</code> scripts as you discover data transformations that should be made earlier on in the workflow.</p>
<p>Use <code>build.R</code> to tie these together - when run, it should rebuild the whole project from scratch, except perhaps downloading data. You may want to build different versions of <code>build_*.R</code> as helpers for running different parts of the workflow while you work. If you deal with lots of build scripts, use the wonderful (pun intended) <a href="https://netique.github.io/buildr/" class="external-link">{buildr}</a> package.</p>
</div>
<div class="section level3">
<h3 id="document-templates">3. Document templates<a class="anchor" aria-label="anchor" href="#document-templates"></a>
</h3>
<p>There are two templates in the package: Schola PDF report (prefered) and Schola Word report.</p>
<p>The PDF report use LaTeX to create typographically correct, completely vector-graphics document.</p>
<p>The Word report is simple: it creates a Word document with some nice custom defaults and styles.</p>
</div>
<div class="section level3">
<h3 id="ggplot2-theme">4. ggplot2 theme<a class="anchor" aria-label="anchor" href="#ggplot2-theme"></a>
</h3>
<p><code>reschola</code> offers a ggplot2 theme, <code><a href="../reference/theme_schola.html">theme_schola()</a></code>, which provides some sensible easthetic defaults, including font choice, to make charts beautiful and consistent.</p>
<p>The desired approach is to use this theme, alter its parameters if needed, and then if necessary make other changes using another <code><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme()</a></code> call.</p>
<p>There are also a small number of other plotting utilities.</p>
<p>See the <a href="charts.html">Making charts</a> vignette for details on everything graphics related.</p>
</div>
<div class="section level3">
<h3 id="utilities">5. Utilities<a class="anchor" aria-label="anchor" href="#utilities"></a>
</h3>
<p>There are also utilities, e.g. for creating report drafts (<code>draft_*()</code>) and for interacting with Google Drive (<code>gdrive_*()</code>)</p>
</div>
</div>
<div class="section level2">
<h2 id="step-by-step">Step by step<a class="anchor" aria-label="anchor" href="#step-by-step"></a>
</h2>
<div class="section level3">
<h3 id="start-a-new-project">1. Start a new project<a class="anchor" aria-label="anchor" href="#start-a-new-project"></a>
</h3>
<p>In RStudio, go to <code>File &gt; New Project &gt; New directory &gt; Standard Schola Empirica Project</code>.</p>
<blockquote>
<p>Ideally, start from a clean RStudio session with no project open.</p>
</blockquote>
<p>Fill in the fields (only directory name is mandatory), switch the Git menu to get a (reschola/your) Github repo of you wish, select other options if needed, check “Open in new session”, and click <code>Create</code>.</p>
<p>Other ways are possible but this gives you a good starting point and takes care of a lot of the setup hassle for you.</p>
<div class="section level5 bs-callout bs-callout-red">
<h5 id="not-committing-sensitive-data-to-git">Not committing sensitive data to git<a class="anchor" aria-label="anchor" href="#not-committing-sensitive-data-to-git"></a>
</h5>
<p>The <code>data-input</code> and <code>data-processed</code> have <code>.gitignore</code> files in to stop you form committing sensitive data to git. Commit these <code>.gitignore</code> files to git. But only alter them if you are sure you know what you are doing.</p>
</div>
<div class="section level4 bs-callout bs-callout-yellow">
<h4 id="google-authentication">Google Authentication<a class="anchor" aria-label="anchor" href="#google-authentication"></a>
</h4>
<p>If you haven’t used the <code>googledrive</code> package before, the package may ask for authorisation to access Google Drive. This is legitimate and you should grant access. This happens in the browser and on some machines may cause project initiatition to freeze or stop. If that happens, run <code><a href="https://googledrive.tidyverse.org/reference/drive_auth.html" class="external-link">googledrive::drive_auth()</a></code>, delete the directory created by the previous project creation attempt, and try creating the project again.</p>
</div>
<div class="section level4">
<h4 id="renv-managing-package-dependencies">
<code>renv</code>: managing package dependencies<a class="anchor" aria-label="anchor" href="#renv-managing-package-dependencies"></a>
</h4>
<p>One of the most annoying barriers do reproducibility is when packages on which your code depends change over time and as a result your code breaks or behaves differently.</p>
<p>The most convenient and sophisticated way to handle this is to use the <code>renv</code> dependency management system. <code>renv</code></p>
<p>In short, it makes sure that your project holds a complete record of the exact package versions you are using when creating it.</p>
<p>When to use it:</p>
<p>Always, really, but especaially when:</p>
<ul>
<li>you start collaborating on a project with someone else</li>
<li>you are putting a project aside for a while</li>
<li>you want it to run on a remote machine, e.g. to build and publish a website through Travis CI or Github Actions</li>
</ul>
<p>What it does:</p>
<ul>
<li>creates a project-specific library</li>
<li>installs the packages on which your code depends into it</li>
<li>records the exact versions of these packages in something called a lockfile - a small text file that you keep and commit into git alongside your code</li>
<li>sets up the project such that the project library is rebuilt with the minimum amount of hassle when you open it up in the future or someone else clones it.</li>
</ul>
<p>To save avoid wasting time, disk space and download bandwidth, <code>renv</code> keeps a copy of all the package versions used in your projects in a shared per-computer cache. The project libraries only contain links to that cache. That way you are not committing the package code into your project, nor do the package files sit in your project directory, and they only get downloaded once if multiple projects’ libraries use the save version of a package.</p>
<p>All you need to do is call <code>renv::init()</code> at the beginning and then <code>renv::snapshot()</code> anytime you install new packages or commit code.</p>
<p>See <a href="https://rstudio.github.io/renv/" class="external-link uri">https://rstudio.github.io/renv/</a> for an intro to the package and <a href="https://environments.rstudio.com/" class="external-link uri">https://environments.rstudio.com/</a> for a broader intro.</p>
<p>Renv is not part of the standard project setup in <code>reschola</code> so as not to increase the complexity of project initiation, but it is much recommended that you use it.</p>
</div>
</div>
<div class="section level3">
<h3 id="download-the-data">2. Download the data<a class="anchor" aria-label="anchor" href="#download-the-data"></a>
</h3>
<p>Use <code>001_retrieve-data.R</code>; if you have other data retrieval, ideally the code for it should live here.</p>
<p>Do not edit the data by hand.</p>
<p>See <a href="tips.html">tips</a> for some packages that can help you retrieve data from public sources or other systems.</p>
</div>
<div class="section level3">
<h3 id="read-in-check-and-process-the-data">3. Read in, check and process the data<a class="anchor" aria-label="anchor" href="#read-in-check-and-process-the-data"></a>
</h3>
<p>Use <code>002_read-data.R</code>. Add any other data reading that is needed.</p>
<p>See <code><a href="https://readr.tidyverse.org/reference/locale.html" class="external-link">readr::locale()</a></code> for handling encoding, decimal marks and separators in CSVs. You might also need <code><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">readr::read_csv2()</a></code>.</p>
<p>Use <code><a href="https://readr.tidyverse.org/reference/encoding.html" class="external-link">readr::guess_encoding()</a></code> if the text comes in garbled.</p>
<p>Use <code>003_check-and-process-data.R</code>. You may need to move this into an RMarkdown document.</p>
<p>See <a href="tips.html">tips</a> for packages that can help you set up a structured data checking pipeline.</p>
<div class="section level4 bs-callout bs-callout-yellow">
<h4 id="data-and-git">Data and git<a class="anchor" aria-label="anchor" href="#data-and-git"></a>
</h4>
<p>You may want to commit some of the summarised/processed data output here once you have done some analysis and are reasonably sure it will not change too often. But generally, data should not be committed, esp. if large or at risk of committing personal information.</p>
</div>
</div>
<div class="section level3">
<h3 id="exploreanalyse-the-data">4. Explore/Analyse the data<a class="anchor" aria-label="anchor" href="#exploreanalyse-the-data"></a>
</h3>
<p>I suggest you keep your data exploration in a separate script from your report; often the EDA will happen in the report as you go, but a better process perhaps is to develop bits of your analysis in one script/Rmd and only move bits of code into the report Rmd which is essential for building the report.</p>
<p>An RMarkdown Notebook might be an appropriate format for this.</p>
<p>See <a href="tips">tips.html#data-exploration-1</a> for a list of appropriate tools for data exploration.</p>
<div class="section level4 bs-callout bs-callout-blue">
<h4 id="approaches">Approaches<a class="anchor" aria-label="anchor" href="#approaches"></a>
</h4>
<p>There is a real trade off here: one way to do it is to work through the analysis in the report script, perhaps hiding most through chunk options (<code>include =  FALSE</code>) and only outputting into the final format stuff that is relevant.</p>
<p>That way you get a sense of the thought process but also a bloated and circuitous script. Another is to do the analysis in one or more files and only moving bits into the report which are needed there.</p>
<p>That way you get a tight report script but at times disconnected from the analytical process.</p>
<p>One way to lighten the load is to hive off some work into partial Rmarkdown files, typically named <code>_something.Rmd</code>, and then “insert” them into the main document via</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1"></a><span class="bn">```{r child=c('_one.Rmd', '_two.Rmd')}</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="bn">```</span></span></code></pre></div>
<p>```</p>
<p>See RMarkdown Cookbook <a href="https://bookdown.org/yihui/rmarkdown-cookbook/child-document.html" class="external-link">on child documents</a>.</p>
</div>
</div>
<div class="section level3">
<h3 id="write-reports-using-a-template">5. Write reports using a template<a class="anchor" aria-label="anchor" href="#write-reports-using-a-template"></a>
</h3>
<p>Use <code>draft_*</code> to quickly create a draft using the required template.</p>
<p>The Word output of the two templates is aesthetically equivalent, but the <code>_word</code> template (and output format as set in the YAML header) can do more sophisticated handling of e.g. <a href="#footnotes-and-cross-references">cross-references</a>.</p>
<p>Note the <code>schola_word</code> format is based on the <code><a href="https://pkgs.rstudio.com/bookdown/reference/html_document2.html" class="external-link">bookdown::word_document2</a></code> format. This means it can be customised like <a href="https://bookdown.org/yihui/bookdown/" class="external-link">other bookdown documents</a> and even strung into a whole book.</p>
<div class="section level4">
<h4 id="footnotes-and-cross-references">Footnotes and cross-references<a class="anchor" aria-label="anchor" href="#footnotes-and-cross-references"></a>
</h4>
<p>You can create a cross-reference to any section, e.g. link to section Methods using <code>[Methods]</code> or <code>[the methods section][Methods]</code>. This will show up as a link in Word and HTML.</p>
<p>Create a footnote by using <code>Text^[This is a footnote]</code>.</p>
<p>You can also refer to tables, figures and equations. This only works in the <code>schola_word</code> output format (template).</p>
<p>Do it like this (note that <code>@</code> is escaped with <code>\</code>):</p>
<ul>
<li>
<code>See table \@ref(fig:graf6).</code> to ref to a table in a chunk named <code>graf6</code>
</li>
<li>
<code>As table \@ref(tab:tab3) shows...</code> for a table in a chunk named <code>tab3</code>
</li>
</ul>
<p>Note that these chunks need to have the <code>fig.cap</code> set to a non-empty string, and they need to have a chunk name <strong>without underscores or any special character</strong> (camelCase style is recommended). Yihui Xie <a href="https://yihui.org/knitr/options/" class="external-link">says</a>:</p>
<blockquote>
<p>Try to avoid spaces, periods (.), and underscores (_) in chunk labels and paths. If you need separators, you are recommended to use hyphens (-) instead. For example, setup-options is a good label, whereas setup.options and chunk 1 are bad; fig.path = ‘figures/mcmc-’ is a good path for figure output, and fig.path = ‘markov chain/monte carlo’ is bad.</p>
</blockquote>
<p>Edit <code>_bookdown.yml</code> to change the words used for “Figure” and “Table” in captions (doesn’t apply for PDF).</p>
<p>See more on cross-references <a href="https://bookdown.org/yihui/bookdown/cross-references.html" class="external-link">in the bookdown guide</a>.</p>
</div>
<div class="section level4 bs-callout bs-callout-blue">
<h4 id="citations">Citations<a class="anchor" aria-label="anchor" href="#citations"></a>
</h4>
<p>Knitr and Rmarkdown incorporate a system for managing citations and bibliographies, which can take reference lists from a number of citation managers. For the basics, see the <a href="https://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html" class="external-link">RMarkdown site</a>, details are in the <a href="https://bookdown.org/yihui/rmarkdown-cookbook/bibliography.html" class="external-link">RMarkdown Cookbook</a>.</p>
</div>
<div class="section level4">
<h4 id="web-output">Web output<a class="anchor" aria-label="anchor" href="#web-output"></a>
</h4>
<p>In principle, if you want a HTML file you can just switch the format to <code>html_document</code> and it should work fine if perhaps the details might differ slightly. See <a href="tips.html">tips</a> on how to get that online.</p>
</div>
<div class="section level4">
<h4 id="parameterising">Parameterising<a class="anchor" aria-label="anchor" href="#parameterising"></a>
</h4>
<p>If you expect your report to be rerun in some time with different data or a different parameter, like a changed date or name of something, you can make your report parameterised. See this <a href="https://rmarkdown.rstudio.com/lesson-6.html" class="external-link">brief guide</a> or a <a href="https://bookdown.org/yihui/rmarkdown/parameterized-reports.html" class="external-link">longer explanation</a>.</p>
<p>This is also useful if you are running the same report for a number of units of something, e.g. for different waves of research or different geographical units - see <a href="https://medium.com/@urban_institute/iterated-fact-sheets-with-r-markdown-d685eb4eafce" class="external-link">how the Urban Institute does it</a>.</p>
</div>
<div class="section level4">
<h4 id="visualising">Visualising<a class="anchor" aria-label="anchor" href="#visualising"></a>
</h4>
<p>Charts should be created using <code>ggplot2</code> as far as possible. Use the <code>schola_theme()</code> theme.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;See the &lt;a href="charts.html"&gt;Making charts&lt;/a&gt; vignette for more details.&lt;/p&gt;'><sup>1</sup></a></p>
</div>
</div>
<div class="section level3">
<h3 id="iterate-steps-3-6">6. Iterate steps 3-6<a class="anchor" aria-label="anchor" href="#iterate-steps-3-6"></a>
</h3>
<p>None of this is a linear process. The only requirement is that from an external point of view (and that includes you in three months or two years), the process of rebuilding the report(s) and the entire project is linear.</p>
<p>But as you work, you will find bits of code that belong somewhere else; you will make data transformations in your report that you will then realize you can move to your data transformation script. You will load new data in a script and than move that loading code to an earlier script. That is fine - it will happen gradually through iteration, but the iteration should also move you towards more organised code.</p>
<p>The logic described by Emily Riederer in her <a href="https://emilyriederer.netlify.com/post/rmarkdown-driven-development/" class="external-link">RMarkdown driven development</a> approach may be helpful here.</p>
<p>In the end, the scripts should follow these principes:</p>
<ol style="list-style-type: decimal">
<li>each should be able to run separately, in the sense that it doesn’t fail, that is</li>
<li>it reads its own data (possibly written by a previous script)</li>
<li>it should write its data if another script is expected to use them (though ideally this would all be done by a data-transformation script early on)</li>
<li>it should load its libraries, shared variable and functions</li>
</ol>
<p>Don’t forget to update the README.md and other documentation as you go, as well as <code>build.R</code> and any other <code>build*.R</code> scripts you may have.</p>
<p>Feel free to use git to go back and forth. Version control is your friend here. Something broke? You can go back to when it worked.</p>
<p>See <a href="workflow.html">workflow</a> guidance for a primer on git and Github, which should be a core part of your process.</p>
<p>When a draft report goes out e.g. to stakeholders for feedback, it might be useful to create a <a href="https://happygitwithr.com/git-basics.html" class="external-link">git tag</a>:</p>
<blockquote>
<p>You can also designate certain snapshots as special with a tag, which is a name of your choosing. In a software project, it is typical to tag a release with its version, e.g., “v1.0.3”. For a manuscript or analytical project, you might tag the version submitted to a journal or transmitted to external collaborators. Figure 20.1 shows a tag, “draft-01”, associated with the last commit.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="finalise-report">7. Finalise report<a class="anchor" aria-label="anchor" href="#finalise-report"></a>
</h3>
<p>Run <code><a href="../reference/manage_docx_header_logos.html">reschola::manage_docx_header_logos()</a></code> to replace default Schola logo or add a client/funder logo.</p>
</div>
<div class="section level3">
<h3 id="prepare-project-for-reuse">8. Prepare project for reuse<a class="anchor" aria-label="anchor" href="#prepare-project-for-reuse"></a>
</h3>
<p>Really just make sure that you have followed the steps. If you have, then:</p>
<ul>
<li>files should be named properly and with the correct order</li>
<li>each Rmd file should run without error</li>
<li>
<code>build.R</code> should contain all scripts needed to run the whole thing in the right order; so should any other built-type script you may have created</li>
<li>README.md should contain workable instructions</li>
</ul>
<p>Additionally, you should use <code>renv</code> and snapshot the state of the project library using <code>renv::snapshot()</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="tools-for-implementing-good-practices">Tools for implementing good practices<a class="anchor" aria-label="anchor" href="#tools-for-implementing-good-practices"></a>
</h2>
<div class="section level3">
<h3 id="tidyverse-approach-and-tidy-data">Tidyverse approach and tidy data<a class="anchor" aria-label="anchor" href="#tidyverse-approach-and-tidy-data"></a>
</h3>
<p>See <a href="https://r4ds.had.co.nz/" class="external-link">R for Data Science</a> by Hadley Wickham and Garret Grolemund.</p>
<p>The rest mostly draws on <a href="https://rstats.wtf" class="external-link"><strong>W</strong>hat <strong>T</strong>hey <strong>F</strong>orgot to teach you about R</a>, which seems to have the remedy to many common pains of working with R.</p>
</div>
<div class="section level3">
<h3 id="blank-slates">Blank slates<a class="anchor" aria-label="anchor" href="#blank-slates"></a>
</h3>
<p>See RStudio part in <a href="setup.html">setup</a> for the options to set for this.)</p>
</div>
<div class="section level3">
<h3 id="safe-paths">Safe paths<a class="anchor" aria-label="anchor" href="#safe-paths"></a>
</h3>
<p>Use the <code>here</code> package instead of <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd()</a></code> to <a href="https://github.com/jennybc/here_here" class="external-link">make sure paths just work</a>.</p>
</div>
<div class="section level3">
<h3 id="file-naming-conventions">File naming conventions<a class="anchor" aria-label="anchor" href="#file-naming-conventions"></a>
</h3>
<p>See <a href="https://speakerdeck.com/jennybc/how-to-name-files" class="external-link">Naming things</a> by Jenny Bryan.</p>
<ul>
<li>machine readable: ASCII, no spaces, sensible separators (<code>_</code> between parts, <code>-</code> between words)</li>
<li>human readable: descriptive words in title, consistent logic across files</li>
<li>plays well with default ordering: 01 x 11, sensible separators, all lowercase, YYYY-MM-DD dates</li>
</ul>
</div>
<div class="section level3">
<h3 id="safe-storage-of-secret-and-confidential-information">Safe storage of secret and confidential information<a class="anchor" aria-label="anchor" href="#safe-storage-of-secret-and-confidential-information"></a>
</h3>
<ul>
<li>use .Renviron for passwords (or look at <code>keyring</code>), never hard code them (<code><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">usethis::edit_r_environ()</a></code>)</li>
<li>store individual data on team GDrive and only download for analysis; do not commit to git</li>
</ul>
<div class="section level4 bs-callout bs-callout-yellow">
<h4 id="ignore-files-in-git">Ignore files in git<a class="anchor" aria-label="anchor" href="#ignore-files-in-git"></a>
</h4>
<p>You can add files you do not wish to commit to git’s ‘.gitignore’ file. That way, git will not even show those as new/changed. This works separately for each repo.</p>
<p>The easiest way to do this is to run e.g. <code>usethis::use_git_ignore("secret_file.R")</code>.</p>
<p>You need to commit the <code>.gitignore</code> file.</p>
</div>
</div>
<div class="section level3">
<h3 id="other-bits-of-good-practice-to-follow">Other bits of good practice to follow:<a class="anchor" aria-label="anchor" href="#other-bits-of-good-practice-to-follow"></a>
</h3>
<div class="section level4">
<h4 id="in-r-code">In R code:<a class="anchor" aria-label="anchor" href="#in-r-code"></a>
</h4>
<ul>
<li>Document why you wrote that code (not necessarily just what it does, which should be obvious)</li>
<li>don’t use T and F for TRUE and FALSE</li>
<li>use only trustworthy packages, ideally CRAN-based unless there is a good reason to do otherwise.</li>
</ul>
<p>See the <a href="http://mangothecat.github.io/goodpractice/" class="external-link"><code>goodpractice</code></a> package for a list of good practice and automated checking for them.</p>
</div>
<div class="section level4">
<h4 id="with-version-control">With version control<a class="anchor" aria-label="anchor" href="#with-version-control"></a>
</h4>
<ul>
<li>Write informative commit messages</li>
<li>don’t overwrite history (force push) unless absolutely necessary</li>
<li>commit often, push carefully</li>
<li>pushed commits should contain complete changes such that the code will run without errors.</li>
<li>always work in UTF-8: save code in RStudio as UTF-8, save input CSV as UTF-8, and save any R text output as UTF-8.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="style">Style<a class="anchor" aria-label="anchor" href="#style"></a>
</h3>
<p>Currently we have no explicitly agreed style.</p>
<p>Still, following some basic code hygiene seems like a good idea:</p>
<ul>
<li>sensible indents</li>
<li>lower_case_var_names</li>
<li>functions are verbs, like do_something()</li>
<li>spaces around operators like <code>=</code> and <code>+</code>
</li>
<li>break lines at around 80 characters</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="resources-for-building-reproducible-workflows">Resources for building reproducible workflows<a class="anchor" aria-label="anchor" href="#resources-for-building-reproducible-workflows"></a>
</h2>
<p><a href="https://github.com/ropensci/drake" class="external-link">Drake</a>, <a href="https://pkg.garrickadenbuie.com/drake-intro/#1" class="external-link">intro slides</a></p>
<p><a href="https://resources.rstudio.com/rstudio-conf-202" class="external-link">Sharla Gelfand</a> on reproducible reporting with RMarkdown at rstudio::conf(2020) Emily Riederer on <a href="https://emilyriederer.netlify.com/post/rmarkdown-driven-development/" class="external-link">RMarkdown driven development</a></p>
<p>Wilson et al. 2016, <a href="https://arxiv.org/abs/1609.00037" class="external-link">“Good Enough Practices in Scientific Computing”</a></p>
<p><a href="https://github.com/benmarwick/rrtools" class="external-link"><code>rrtools</code></a> for research compendia</p>
<p><a href="https://ukgovdatascience.github.io/rap-website/" class="external-link">Reproducible Analytical Pipelines</a></p>
<p><a href="https://jdblischak.github.io/workflowr/" class="external-link">Workflowr</a></p>
<p><a href="https://vimc.github.io/orderly/" class="external-link">orderly</a></p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Petr Bouchal, Jan Netík, SCHOLA EMPIRICA, z. s..</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
